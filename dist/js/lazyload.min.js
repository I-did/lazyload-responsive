(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.lazyload=a()})(function(){return lazyload=function(){return function(a){var b=this;for(var c in b.options=a||{},b.defaults={elements:".lazy",srcAttr:"data-src",mediaAttr:"data-media",clearSrc:!1,clearMedia:!1},b.elements=[],b.currentPixelRatio={},b.defaults)void 0===b.options[c]&&(b.options[c]=b.defaults[c]);b.init()}}(),lazyload.prototype.init=function(){for(var a=this,b=a.options,c=document.querySelectorAll(b.elements),d=/\n|\t|\s{2,}/gm,e=/\(max\-width.*?\)|\(min\-width.*?\)/g,f=/\{.*?\}/g,g={imgSet:/image-set\((.*?)\)/,pxRatio:/[0-9.]+x$/,src:/.*(?=\s[0-9.]+x$)/,split:/\,\s|\,/},h=0;h<c.length;h++){var k=c[h].getAttribute(b.mediaAttr),l=c[h].getAttribute(b.srcAttr),m=void 0,n=void 0;if(c[h].lazyObject={src:a.imgSrcParse(l,g),media:{}},k){k=k.replace(d,""),m=k.match(e),n=k.match(f);var o=c[h].lazyObject.media;o.length=m.length;for(var p=0;p<o.length;p++)o[m[p]]=a.imgSrcParse(n[p].slice(1,-1),g);b.clearMedia&&c[h].removeAttribute("data-media")}if(b.clearSrc&&c[h].removeAttribute("data-src"),a.elements.push(c[h]),"function"==typeof window.CustomEvent){var j=new CustomEvent("lazyinit");c[h].dispatchEvent(j)}}a.getPxRatio(),a.startObserve()},lazyload.prototype.imgSrcParse=function(a,b){this;if(-1!==a.search("image-set")){for(var c={},d=a.replace(b.imgSet,"$1"),e=d.split(b.split),f=0;f<e.length;f++){var g=e[f].match(b.pxRatio)[0],h=e[f].match(b.src)[0];c[g]=h}return c}return a},lazyload.prototype.getPxRatio=function(){for(var a,b,c=this,d=+window.devicePixelRatio.toFixed(1),e=1;10>e;e++)if(1==e){if(d<=e){a=e+"x",b=e;break}}else if(d>e-1&&d<=e){a=e+"x",b=e;break}c.currentPixelRatio.str=a,c.currentPixelRatio.num=b},lazyload.prototype.startObserve=function(){for(var a=this,b=a.elements,c=new IntersectionObserver(function(b){b.forEach(function(b){if(b.isIntersecting){var d,e,f=b.target,g=f.lazyObject,h=g.src,i=g.media;for(var j in i)"length"!=j&&matchMedia(j).matches&&(e=j);var k=e?i[e]:d?"":h;switch(d=a.setImg(k),f.tagName.toLowerCase()){case"img":f.src=d;break;case"header":case"section":case"footer":case"main":case"div":case"span":case"button":case"form":case"article":f.style.backgroundImage=d;}if("function"==typeof window.CustomEvent){var l=new CustomEvent("lazyloaded");f.dispatchEvent(l)}c.unobserve(f)}})}),d=0;d<b.length;d++)c.observe(b[d]);window.addEventListener("resize",function(){a.getPxRatio();for(var d=0;d<b.length;d++)c.unobserve(b[d]),c.observe(b[d])})},lazyload.prototype.setImg=function(a){var b=this,c="";if("string"==typeof a)c=a;else{var d=a[b.currentPixelRatio.str];if(!d)for(var e=1;10>e;e++){var f=b.currentPixelRatio.num-e+"x",g=a[f];if(g){d=g;break}}c=d}return c},lazyload});